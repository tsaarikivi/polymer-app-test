<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">

<dom-module id="my-add-dialog">
    <template>

        <style>
             :host iron-input {
                width: 100%;
            }

             :host iron-input input {
                width: calc(100% - 16px);
                margin-bottom: 16px;
                padding: 8px;
                border: 0;
                border-bottom: 1px solid grey;
            }

             :host iron-input textarea {
                width: calc(100% - 16px);
                resize: none;
                border: 0;
                border-bottom: 1px solid grey;
                padding: 8px;
            }

             :host iron-input textarea:focus,
             :host iron-input input:focus {
                outline: 0;
                border-bottom: 2px solid black;
            }

            .error-input {
                border-bottom: 2px solid #E31616;
            }
        </style>

        <paper-dialog on-iron-overlay-closed="onClose" opened="[[open]]">

            <h2>Set event</h2>
            <iron-form id="event-form">
                <form>
                    <iron-input bind-value={{title}}>
                        <input id="titleInput" placeholder="Title" name="title" required>
                        </input>
                    </iron-input>

                    <iron-input bind-value={{note}}>
                        <input id="noteInput" placeholder="Note" name="note" required>
                        </input>
                    </iron-input>

                    <div class="buttons">
                        <paper-button type="button" dialog-dismiss>Cancel</paper-button>
                        <paper-button on-click="handleFormSubmit" type="submit" autofocus>Add</paper-button>
                    </div>
                </form>
            </iron-form>

        </paper-dialog>

    </template>

    <script>
        class MyAddDialog extends Polymer.Element {
            static get is() { return 'my-add-dialog'; }
            static get properties() {
                return {
                    selectedItem: {
                        type: Object
                    },
                    open: {
                        type: Boolean,
                    },
                    title: {
                        type: String,
                        computed: "_computeTitle(selectedItem)"
                    },
                    note: {
                        type: String,
                        computed: "_computeNote(selectedItem)"
                    }
                }
            }

            onClose(event) {
                this.dispatchEvent(new CustomEvent('close'))
            }

            _computeTitle(item) {
                console.log(item.title);
                return (!item.free && item.title) ? item.title : "";
            }

            _computeNote(item) {
                return (!item.free && item.note) ? item.note : "";
            }

            handleFormSubmit() {

                if (this.title === "" || this.title === undefined) {
                    this.$["titleInput"].className = "error-input"
                }
                else {
                    this.dispatchEvent(new CustomEvent("add", { detail: { title: this.title, note: this.note } }))
                    this.set("title", "");
                    this.set("note", "");
                }

            }
        }
        window.customElements.define(MyAddDialog.is, MyAddDialog);
    </script>

</dom-module>